**24.24-ETH-反思(Av37065233,P24)**

同学们，我们上节课讲了the倒这个智能合约发生的倒闭事件，以及随后以太坊团队采取的补救措施。这件事给以太坊造成了很大的影响。我们现在回顾一下这个事件，大家觉得应该引起我们什么样的反思？我们首先讲一下关于智能合约的反思。

智能合约真的智能吗？首先我们要明白，智能合约里并没有用到任何人工智能的技术。所以有人认为其实应该把它叫做自动合约，按照事先写好的代码自动执行某些操作。

我们现实世界当中，大家能想到什么自动合约的例子吗？就自动执行某些操作例。Atm取款机实际上可以看作是物理世界上的一个自动合约。你把银行卡插进去输入密码，它就自动把钱吐给你。所以它是一种自动合约，按照事先规定好的逻辑去做某些事情。所以智能合约其实并不智能，而且是挺笨的，一旦写好之后就改不了了。所以它实际上是一种代码合同，这个可以作为我们今天的第一个反思。

Smart contract is anything but smart,
它并不智能。第二个我们说过智能合约写好之后就改不了了。这就是涉及到区块链的不可篡改性。一般来说我们提到不可篡改性认为是区块链的一个优点，有很多区块链的应用都是利用了不可篡改性，比如说用它来做防伪溯源。但是通过这个事件，我们其实应该意识到，不可篡改性其实是一个双刃剑。

什么意思呢？就是一方面来说不可篡改性增加了合约的公信力。我们大家都能都只能按照合约中的规则去来，没有人能够篡改这个规则，这是好的一方面。但是另一方面，不可篡改性也意味着如果规则中有漏洞，我们想要修补这个漏洞，想软件升级都是很困难的。

像这次的道的倒逼事件，有传闻说the道的开发团队在发生倒闭事件前几天，已经收到了有关这个智能合约中存在安全漏洞的消息，但是没有来得及发布更新后的软件，这个如果是对于一个中心化的系统，大家可能会觉得是很难想象的。就如果你发现了你的软件中有安全漏洞，你干嘛不及时发布一个安全补丁呢？就像PaaS，就大家都用过一些大公司的软件，有安全漏洞的他都会发布一些配置。

但是问题在于在区块链的世界里，你怎么发布派置软件更新需要硬分叉来实现，要得到绝大多数矿工愿意升级到你这个更新之后的软件才能够成功。不论是比特币也好，还是以太坊也好，硬分差都不是随便搞的。像这次以太坊搞的硬分叉，最后就造成了两条平行的链。而且你要搞硬分差的话，你要说明理由。否则的话，别的矿工为什么要升级到你这个更新后的软件。而你一旦说明理由的话，就容易把这个安全漏洞的信息泄露出去。么有恶意的攻击者可能会在还没有来得及升级软件之前抢先发动攻击。

这些都是区块链上不可篡改性带来的一些问题。另外不可篡改性的另外一个问题在于，即使我们已经发现了这个安全漏洞，已经有人进行恶意攻击了。我们想要冻结账户终止交易都是很困难的。

这个也是跟我们日常生活的体验不太一样的地方。比如说你的银行卡信息被盗了，你发现你的银行账户信息泄露出去了，这时候你会怎么办？你的第一反应是通知银行冻结账户，修改你的密码。

很多人在刚刚接触区块链的时候也是同样的反应，发现我这个比特币账户的私钥泄露出去了。那我怎么办？赶快通知谁把这个账户给冻结了，没有办法冻结。大家听明白了吗？你要冻结账户得要软分叉，就实质上你等于是要发布一个比特币软件的更新，凡是跟你这个账户相关的交易都不予执行，这才能够冻结。像这次倒闭事件之后，以太坊团队一开始采取的补救措施就是这么干的。但是对于你的个人账户来说，不会因为你个人账户的私要泄露出去了，就搞一个软分叉，这是不可能的。那么这时候实际上你应该怎么办？

你应该赶快把你账户上剩下的钱转移到另外一个安全账户去，就只能采取这种补救措施。与之相关的一个问题，这个智能合约一旦发布到区块链上之后，没有办法阻止对他的调用。比如说这次的倒逼事件，黑客偷走了差不多3分之1的以台币。还有3分之2的以太币仍然是在得到这个智能合约以及它下面的一些子基金里，同样存在着安全的风险。那这时候怎么办呢？我们直观上感觉是说，既然那个智能合约有问题了，那就不能让大家再去调它了。但是区块链上你没有办法阻止对智能合约的调用，你要阻止的话又得软分叉，就等于要增加一条新的规则，凡是调用这个智能合约的交易都不予执行。大家听明白了吗？所以其实应该怎么办？

如果你是一个the道德用户。这个智能合约的资金已经被偷走了3分之1了，还剩3分之2，你应该怎么办？

马上通知以太坊团队，这是对的这是一种方法。你作为你本人，你还能做什么别的事情吗？其实跟刚才说的情况是一样的，就跟你私要泄露的情况一样。你应该在第一时间把剩下3分之2的钱转走，转到一个安全的账户。什么转走？

你说智能合约没有提供这个转账功能。

我先拿回来。

除非你先拿回来转出去。开阔思路。

就这个背景大家听明白了吧？这个智能合约发现有漏洞了，已经发布出去了改很难改，要软分叉，不让别人调用也很难，也得软分产。现在还有一部分钱，很大一部分钱在里面存在危险，你应该怎么办？对了，这说的对了，用黑客的这个漏洞把钱转走，这个不是开玩笑，真的是当时就有人就建议这么做。就比如说你是个好人，你创建一个新的智能合约，把这个事情公布给大家，说现在我要干一件事情，就是把剩下的钱转移到这个安全的智能合约。然后你用黑客同样的方法发动攻击，把剩下这些钱转到这个新的智能合约里保管起，就手段跟这种宠辱攻击是一样的，只不过你的目的是好的。这个新的合约是将来为了把钱退给大家。

大家听明白了吗？那下面我们讲第三个反思。

Nothing is irrevocable.
如果我们前面说不可篡改性是个双刃剑，我们现在要想一想，有什么是真的不可篡改的。其实都可以改，对不对？我们前面说的比较多的是分叉攻击的例子。就比如说有一笔交易本来是写到区块链里面了，然后有一个黑客从这个区块前面开始分叉，导致后面的交易被回滚。这是我们前面说过一个篡改的例子。以太坊这次事件当中，实际上是开发团队通过软件升级的方法，强行改变某些账户的状态。所以不要迷信区块链的不可篡改性，毕竟代码是死的，人是活的，没有什么是绝对改不了的。

连宪法都可以修宪，大家知道美国的宪法修正案吗？听说过吧？美国宪法第一修正案老百姓有言论自由的权利。第二修正案老百姓有拥有枪支的权利。大家现在可能觉得好像听那些修正案，修正案是什么意思？就是对宪法的修改和补充。连宪法都可以修改，那还有什么是改不了的？

而且美国宪法修正案还有过被推翻的例子，大家知道是哪一个吗？曾经美国历史上通过一个修法修正案，十几年以后又被推翻了。奴隶制谁说被推翻了？解放奴隶宣言的宪法修正案怎么可能被推翻？

主要是推翻的时间太长了，你们这一代可能都没有任何印象。

美国宪法第十八修正案禁酒令。Pro是就美国曾经历史上有一段时间全国范围内是禁酒的，生产销售酒精饮料是违法的。当时提出这个修正案的初衷是什么？是为了解决因为酗酒带来很多疾病、社会问题。他初衷是好的，但是真正实施起来问题很大，可以说是事与愿违。你敬酒之后，并不是说大家就真的不去生产销售酒了，而是说酒的生产和销售转入地下了，变成了有组织的犯罪。

所以这个禁酒令第18修正案提出来之后，大概执行了十几年。大家觉得这个不行了，这样下去的话，社会越来越乱了。所以在第21修正案。把这个禁酒令又取消了。这是美国历史上有宪法修正案被推翻的例子。

但是美国一直到现在对于饮酒还是有很严格的限制。在大街上喝酒是违法的，如果你拿了一听啤酒在大街上边走边喝，这个警察是要抓的。大家注意，如果你们以后去美国的话，这个叫做open
container。

为什么叫open
continu就？如果警察发现你手里拿着一个开着罐的酒精饮料，比如说拿一听拿了一听啤酒已经开了罐了，这就是证据，他就可以逮捕你，这叫open
continual。这个法律也包括在行驶的汽车上喝酒，这个也是违法的。这个跟酒后驾车是两码事儿。酒后驾车是说开车的那个人不能喝酒，这个法律是说车里的所有人都不能喝酒，你就是坐在后座上没有开车也不能喝酒。所以这个同学们以后到美国要注意，当然有些城市美国有少数几个城市是没有open
coner落的那那些个别的城市你喝酒是在大街上喝酒是可以的。在美国大多数地方是不让你在大街上喝酒的。

这个跟区块链有什么关系呢？打个比方，就是美国宪法要修宪是很难的。参众两院要3分之2的票数通过，然后由各个州再投票，要4分之3的州要投票通过宪法才能修改，就修宪是很难的，但是有必要的时候还是可以改的。区块链是一样的，就一般情况下区块链上的内容想要篡改是比较难的，但是遇到重大事件真的想改都还是改得了的。说这是我们今天要说的第三个反思，nothing
is irrevocable.

从语言设计上我们应该有什么样的反思？为什么会出现重入攻击这样的事情？从某种意义上说，扫雷地铁这个语言的特性是反反自然的。就我们一般的理解是我给你转账，你是一个被动的接收者，你不可能再回来调用我，对吧？这是大家一般的反应。但是solid些语言的这个特性是说，我给你转账的操作等于是隐性的调了你的four
bu函数。虽然表面上我没有调任何函数，但是转账本身就是调你的for函数结果，你可以再来调用我。这个跟我们平时的生活体验给人的常识不一样，所以就容易忽视这样的安全漏洞。

有的人提出我们干脆应该用函数式的编程语言，函数式语言比较安全，不容易出现这种漏洞。而且从长远来看，要实现的是对智能合约功能的理论上要证明它的正确性。所以这个就是引起我们的第四个反思，就是soli雷的这个语言设计上有没有什么问题。

说到函数是圆，20年前我在康奈尔读博士的时候，曾经有O写过一个很大的项目。你们有谁听说过这种语言吗？

开幕听说过吗？到现在都没有多少人听说过我，那个年代全世界都没有多少人会用这个语言。这是个这个偶开某就是个函数式语言，非常好用。它里面有那种pattern
matching的功能，写出来的程序非常直观，就很符合人们看起来就是很清楚。缺点是运行起来性能很差，编译出来的代码性能比C加加的程序要慢很多。而且对于初学者来说，他的语法不太直观。

我们一般人熟悉的是那种procdural
language，就基于过程的这种语言，而不是函数式语言。所以一开始看这种，我看代码的时候很多人不习惯，实际上你用熟了之后是非常好用的。就以前我们写代码的时候，其他的同学看不懂，有同学还觉得奇怪，你这个是源代码吗？还是加密过的？其实你要用手是很好用的，为什么我们用camera
o去写？就当时可n有另外一个课题组在做这formal verification的工作。

用形式化的方法证明这个程序的正确性。这个曾经有些人就认为是智能合约的一个终极目标。怎么避免得到这种安全漏洞？就用形式化的方法证明这段代码只能做我们规定好的功能。但是这种formal
verification是一个高大上的目标，在实际实行过程中困难是很大的。一般只能证明一些逻辑比较简单的程序的正确性，而且在证明过程中还需要屏蔽掉很多实现上的细节，这个有时候我们管它叫abstract
away many implementation
details。这样导致的结果就是，即使这个程序你能够从理论上证明是正确的，实际跑起来可能仍然会有问题。

但现在已经过去了20年了，forfication的工作有挺大的进展，但是距离实用还是有很长的距离。比较复杂一点的智能合约程序其实是很难证明出来的。我说这个什么意思呢？就是从语言设计上来说，小了这铁有很多值得改进的地方。但是不是说我们就应该用函数式编程语言，就应该用formal
proof的方法去证明程序的正确性，这个还有待探讨。

语言设计上另一个反思是编写智能合约的语言应该有什么样的表达能力。就我们前面讲过比特币和以太坊的区别，比特币的脚本语言就是很简单的表达能力很差，很多功能表达不出来。而以太坊的编程语言叫图灵完备，就像卡某一样也是图灵完备的。凡是计算机程序能够完成的任务，这两种语言都可以把它实现出来，就solidity和OM但是这种图灵完备的表达能力是不是一个好事情？

就出现这个智能合约的漏洞之后，有些人认为应该去选取一种表达能力适中的语言。就不要像比特币脚本那样表达能力太弱，又不要像以太坊的那个狩猎，这些一样表达能力是图灵完备。就你选的这个语言，什么叫适中？它可以实现我们智能合约要实现的功能，但是又不容易出现安全漏洞。大家听明白了吗？

问题在于什么？你很难找到这样的一个编程语言，你实际上怎么设计？你设计语言的时候很难预料将来有可能出现的所有应用场景，也很难预料将来可能出现的所有安全攻击。所以你这么设计是很难设计出来的。

包括比特币脚本，我们说比特币的脚本是很简单的对吧？在实际应用当中，大多数的矿工也只是接受几个常用的胶本。有一个安全脚本的白名单叫White
list。如果这个交易的脚本不在这个白名单里面，很多矿工缺省情况下是不接受的这大多数的比特币脚本，你实际上去查一下，就是一个很简单的验证。这个交易是否有合法签名的这个job。那怎么办呢？我们想一想，我们现实生活中是怎么解决这个问题的？

现实生活中也有合同，对不对？合同是用自然语言编写的，表达能力也很强。就跟我们这种说话一样，它就是自然语言表达能力也很强。从理论上说也是可能出现各种各样的漏洞，而且这个也不是说单纯从理论上说，以前也出现过，合同条款写的不够严谨，最后执行起来出现纠纷，这个情况也出现过。

那怎么解决的呢？是不是说我们以后就为了写合同，专门设计一种语言合同专用语？其实不是的，解决的方法是通过一些模板。就现在写合同很少有从头开始写的，像大的公司、律师事务所都有专门的模板，都是在模板的基础上进行加减。我觉得这个可能是未来智能合约发展的一个方向。常用的一些智能合约的功能也会出现模板，而且也会慢慢出现专门编写智能合约的机构，就类似于律师事务所一样。所以大家也不要因为这个智能合约中出现各种各样的问题就对他丧失信心。

我们下节课其实还会讲另外一个智能合约出现的安全漏洞，那个智能合约叫美炼the
beauty。但是不论怎么说，智能合约的历史相对来说还是比较短的。那么再过一段时间，它最终还是会逐渐走向成熟，这是我们说的另一个反思。

去中心化的一个好处，有人认为是全sparency，就是透明性好，中心化的系统很多是不开源的，比如像Google、Facebook这些大公司的系统架构都是公司内部的商业机密，外人是没有办法知道的。相比之下，去中心化的系统一般来说都是开源的。因为你得要所有的节点都执行同样的操作才能够达成共。

那么开源有什么好处呢？开源的一个好处就是可以增加这个合约的公信力，接受群众的监督。因为你在区这个区块链这样一个世界里，如果你合约的代码不开源的话，大概没有多少人会相信你。谁知道你那个合约里写的是什么东西，对不对？所以可以增加公信力。

有些人认为开源的另外一个好处是安全，开源的代码不容易出现安全漏洞，因为全世界有这么多双眼睛在看着这个。但是我们已经看到了智能合约的代码出现了各种漏洞。而且这个问题并不是智能合约所特有的，其他的领域很多开源软件也有类似的问题。这就引发了一个思考，既然全世界有这么多双眼睛能够看的这些开源软件，为什么它还会出现这些漏洞？这个有人把它叫做many。

Follow了大这个词大家认识吗？这是错误认识的意思，相当于。мест переев.

这什么意思呢？就是从理论上说，代码是开源的，谁想去看都能去看，好像应该更安全。但是实际当中，真正有时间和精力去看这个源代码的人可能是很少的。

像得到这样的智能合约涉及到财产安全的，你要把你的钱去投进去。从道理上说，你投钱之前，你不得检查一下这个智能合约靠不靠谱。但是很多人可能就没有仔细看，就是看的人也不一定有足够的专业知识能够检测出里面的安全漏洞。

有很多手机上的区块链钱包也是开源的。就手机上的这种钱包，这也是涉及到财产安全。用钱包的这些人当中，有多少是看过他的源代码的，有多少是看得懂的？大家都认为别人肯定看过，全世界这么多人用肯定别人看过，实际上可能没有谁认真看过。

所以不要认为开源软件一定比不开源的软件安全，有很多人用的软件也不一定就没有安全漏洞。历史上有一些开源软件的安全漏洞是很多年以后才被发现。大家听明白了吗？所以的话遇到这种关键性应用，我们还是要小心仔细。你自己要检查一下涉及到财产安全的这个合约写的是不是真的有问题。

下面一个反思是关于去中心化的。区块链技术的追随者一般都是去中心化理念的拥护者。这些人对于现实生活中中心化的管理方式不满意。所以在区块链这个世界里去寻找一种全新的管理方式。这也是为什么以太坊的开发团队在推出了这个硬分差的解决方案之后，引起了那么大的争议。

就有很多人认为这个又回到了中心化的老路上去。你开发团队凭什么靠一个软件升级就把别人账上的钱转走？这个岂不是比中心化更中心化？因为在中心化的社会，你要没收别人财产，法院还要经过很长的法律程序，28天以内还不一定能完得成。但是我们仔细想一下这个过程，这个硬分叉的过程，是不是真的就是以太坊的开发团队说了算了。你们觉得是吗？

What does decentralization mean?
你们觉得这个过程是不是就是以太坊的开发团队说了算？首先他们搞一个投票对不对？最后是大多数人投票支持硬分厂。但是更重要的是什么？以太坊这个团队并没有什么办法强迫大家接受这个投票结果。

最后硬分叉能够成功是因为什么？是因为绝大多数矿工，90%以上的矿工升级的软件，用行动支持了这个应用分厂。即使是这样，还有少部分矿工不同意硬分叉的方案，继续留在旧链上挖矿，那也是他们的自由。以太坊的团队没有什么办法强制他们转过来，你怎么强迫，你强迫不了的。所以去中心化并不是说全自动化让机器决定一切，不能有人为的干预。去中心化并不是说已经制定的规则就不能修改，而是说对规则的修改要用去中心化的方法来完成。我们平时说是用脚投票，大家听说过这说法吧？区块链的世界里是用挖矿来投票的。

这次的硬分叉能够成功，是因为广大矿工认为以太坊的团队做出的这个决定是符合公众利益的。大家不要低估了广大矿工的思想觉悟，如果这个以太坊的团队为了一己私利做出什么决定。比如说把某个账户上的钱转给他们自己，那广大工人阶级肯定不会跟着他们干的这就是关于去中心化的反思。

然后我还要说一下关于分叉的事情。我们一般认为分岔是件坏事儿。本来是一条链，你一分差变成了两条链。但其实你想一下，分叉恰恰是去中心化的，体现在一个中心化的系统里，你是没有办法分叉的，你可以选择放弃，但是你没有办法分叉。

就大家听说过这个以太访的创始人维他利为什么会创建以太坊？听说过这个故事吗？听说过。就一个19岁的小孩特别爱玩游戏，他喜欢打那个叫什么魔兽世界。直到有一天暴雪公司把魔兽里面一个他最喜欢的技能给去掉了，他非常生气，多次找这个暴雪公司反馈，没有得到任何满意的结果他一气之下就不玩了。后来他就想，为什么会出现这种情况？本质上是因为这个游戏是一个中心化的平台上的游戏，决定权在公司，普通用户没有任何办法。所以他决定要创建一个去中心化的平台，用户不满意就有选择分岔的权利。

美国金融危机的时候，美联储搞量化宽松，发行了大量的货币，增加货币供给量。美国很多老百姓是不满意的，尤其是退休的老人，因为钱变得不值钱了。但是你不满意你能怎么办？你分叉你可以选择不用美元，你把美元换成别的货币，这是可以的。但问题是你在美国呆着，你不用美元也不行。

在一个去中心化的系统里，你就可以分叉出现一个新的货币。就比如说以太坊的团队，假设他们哪一天心血来潮了搞量化宽松，大规模增加以太币的供给量，引起很多人的不满，那这些人就可以分叉出来继续维护原来的以太坊。所以存在分叉的选项恰恰是民主的一种体现。大家有问题吗？

最后我们要说的一个反思是。

去中心化跟分布式不是等价的，一个去中心化的系统必然是分布式的，对不对？如果这个系统只运行在一台计算机上，那显然不能叫去中心化。但是分布式系统不一定是去中心化的，即使这个系统运行在成千上万的计算机上，如果这些计算机都是由同一个组织所管辖的，那么也不能叫做去中心化。像谷它的色车安静背后有几十万台服务器，但是这些服务器都是谷内部的，所以仍然不能叫做去中循环。在一个分布式的平台上可以运行一个中心化的应用，也可以运行一个去中心化的应用。比特币和以太坊都是属于交易驱动的状态机，这种状态机的模式就我们以前说过叫做。

State
machine它的特点是让系统中几千台机器重复做同一组操作，付出很大的代价来维护状态的一致性。这个并不是分布式系统常用的工作模式，大多数的分布式系统是让每台机器做不同的事情，然后再把各台机器的工作结果汇总起来，得到最后的结果。这样做的目的是为了比单机速度要快。就比如说我们一台计算机完成某项任务可能需要一个星期，那么用一个十台计算机的分布式集群可能一天就完成了。最理想的状况是得到线性加速比，就是用10台计算机的速度比1台计算机的处理速度要快十倍。但是实际运用当中，线性加数比是很难达到，因为你存在任务切分，然后各个任务之间通讯，然后还要把这个结果汇总，这都是有overhead的。所以实际应用当中，十台计算机的处理速度可能只相当于一台计算机的六七倍。但是仍然是要比一台计算机要强，这样分布式系统才有意义。

这个状态机的模式不是这样的，状态机的目的不是为了比一台计算机处理速度快，而是为了容错。状态机最早的应用场景是什么？是一些mission
critical application。

比如说像。

Air traffic control. Stock exchange.

Space shuttle.

这都是以前状态机一些常见的应用场景。这些场景的特点是什么？这个应用程序为什么叫critical
application？必须无间断的对外提供服务，哪怕宕机一分钟都会造成很大的损失。所以他还他才需要有好几台计算机重复同一组操作。这样即使有一台计算机出现故障，剩下的计算机还能够继续对外提供服务，这是状态机模式的原理。

这样付出的代价是什么？效率很低。几台机器合在一起比1台机器还要慢，因为它得同步状态，而且这个集群里的机器越多，速度越慢。所以传统利用状态机的那些应用场景里，机器的数目都是比较少的，有很多就是个位数字。

像比特币和以太坊中这样上千台机器重复同一组操作这样的场景以前是没有出现过的。我为什么讲这个？同学们当中有一些可能以前没有学过分布式系统，比特币和以太坊。我们这节课讲的这些内容有可能是你们第一次接触分布式系统。不要以为这是分布式系统的常态，其实大多数分布式系统不是这样的。我们能够理解了这一点，就能够理解智能合约比较适用的工作场景是什么。不要把智能合约以太坊上这个一M平台当做是大规模计算或者是大规模存储的服务。如果你这么做的话，不光是速度很慢，而且也是非常贵的，因为要耗很多汽油费。智能合约是用来编写控制逻辑的。

只有那些需要在互不信任的实体之间建立共识的操作，才需要写在智能合约里。如果你需要大规模计算服务的话，你可以用亚马逊的云服务平台。我这节课要讲的就这些，大家有什么问题吗？我们这次正好一节课50分钟，大家有什么问题吗？你们有什么反思吗？

感觉去中心化不是一个绝对的好事，确实不是。好，没有问题，我们这节课就到这儿。
